{% load static %}
{% load permission_tags %}

<div class="navbar-custom">
  <div class="container-fluid">
    <ul class="list-unstyled topnav-menu float-end mb-0">
      <li class="d-none d-lg-block">
      <form class="app-search" method="get" action="{% url 'search' %}">
        <div class="app-search-box dropdown">
          <div class="input-group">
            <input type="search" class="form-control" placeholder="Universal Search..." id="top-search" name="query">
            <button class="btn input-group-text" type="submit">
              <i class="fe-search"></i>
            </button>
          </div>
          <div class="dropdown-menu dropdown-lg" id="search-dropdown">
            <div class="dropdown-header noti-title">
              <h5 class="text-overflow mb-2">Search History</h5>
            </div>
            <div id="search-history-items">
            </div>
          </div>
        </div>
      </form>
      </li>
      <li class="dropdown d-none d-xl-block">
        <a class="nav-link dropdown-toggle waves-effect waves-light" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
            Projects
            <i class="mdi mdi-chevron-down ms-1"></i>
        </a>
        <div class="dropdown-menu">
          {% for user_project in projects %}
            <a href="{% url 'set_current_project' user_project.slug %}" class="dropdown-item {% if user_project == current_project %} active {% endif %}">
              <span>{{user_project.name}}</span>
            </a>
          {% endfor %}
          <div class="dropdown-divider"></div>
          <a href="#" onclick="add_project_modal('{% url 'api:create_project' %}')" class="dropdown-item"><i class="mdi mdi-account-plus"></i> Create New Project</a>
        </div>
      </li>
      {% if user|can:'modify_targets' or user|can:'modify_scan_configurations' or user|can:'modify_system_configurations' or user|can:'modify_wordlists' %}
      <li class="dropdown d-none d-xl-block">
        <a class="nav-link dropdown-toggle waves-effect waves-light" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
          <i class="fe-plus me-1"></i> Quick Add
          <i class="mdi mdi-chevron-down"></i>
        </a>
        <div class="dropdown-menu">
          {% if user|can:'modify_targets' %}
          <a href="#" onclick="show_quick_add_target_modal()" class="dropdown-item">
            <i class="fe-crosshair me-1"></i>
            <span>Target</span>
          </a>
          <a href="{% url 'add_organization' current_project.slug %}" class="dropdown-item">
            <i class="fe-briefcase me-1"></i>
            <span>Organization</span>
          </a>
          {% endif %}
          {% if user|can:'modify_scan_configurations' %}
          <a href="{% url 'add_engine' %}" class="dropdown-item">
            <i class="fe-cpu me-1"></i>
            <span>Scan Engine</span>
          </a>
          {% endif %}
          {% if user|can:'modify_system_configurations' %}
          <a href="{% url 'add_tool' %}" class="dropdown-item">
            <i class="mdi mdi-hammer-wrench me-1"></i>
            <span>External Tool</span>
          </a>
          {% endif %}
          {% if user|can:'modify_wordlists' %}
          <a href="{% url 'add_wordlist' %}" class="dropdown-item">
            <i class="fe-list me-1"></i>
            <span>Wordlist</span>
          </a>
          {% endif %}
        </div>
      </li>
      {% endif %}
      <li class="dropdown d-none d-lg-inline-block topbar-dropdown">
        <a class="nav-link dropdown-toggle arrow-none waves-effect waves-light" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
          <i class="fe-grid noti-icon"></i>
        </a>
        <div class="dropdown-menu dropdown-lg dropdown-menu-end">
          <div class="p-lg-1">
            <h5>Toolbox</h5>
            <div class="row g-0">
              <div class="col" onclick="show_whois_lookup_modal()">
                <a class="dropdown-icon-item" href="#">
                  <img src="/staticfiles/img/global.png" alt="whois">
                  <span>Whois</span>
                </a>
              </div>
              <div class="col" onclick="cms_detector()">
                <a class="dropdown-icon-item" href="#">
                  <img src="/staticfiles/img/magnifying.png" alt="cms_detector">
                  <span>CMS Detector</span>
                </a>
              </div>
              <div class="col" onclick="toolbox_cve_detail()">
                <a class="dropdown-icon-item" href="#">
                  <img src="/staticfiles/img/ladybug.png" alt="cve_lookup">
                  <span>CVE Lookup</span>
                </a>
              </div>
              <div class="col" onclick="toolbox_waf_detector()">
                <a class="dropdown-icon-item" href="#">
                  <img src="/staticfiles/img/firewall.png" alt="waf_detector">
                  <span>WAF Detector</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </li>
      <li class="dropdown notification-list topbar-dropdown">
        <a class="nav-link dropdown-toggle nav-user me-0 waves-effect waves-light" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
          <img src="{% static 'img/boltr-logo.png' %}?v=boltr" alt="BoltR" class="rounded" height="36" width="36" style="object-fit: contain;">
          <span class="pro-user-name ms-1 text-nowrap">BoltR</span>
          <span class="badge bg-danger ms-1 me-1 rengine_update_available">1</span>
          <i class="mdi mdi-chevron-down"></i>
        </a>
        <div class="dropdown-menu dropdown-menu-end profile-dropdown ">
          <div class="dropdown-header noti-title">
            <h6 class="text-overflow m-0">Welcome {{user.get_username}}!</h6>
          </div>
          <a href="{% url 'profile' %}" class="dropdown-item notify-item">
            <i class="fe-user"></i>
            <span>My Account</span>
          </a>
          {% if user|can:'modify_system_configurations' %}
          <a href="{% url 'admin_interface' %}" class="dropdown-item notify-item">
            <i class="fe-settings"></i>
            <span>Admin Settings</span>
          </a>
          <div class="dropdown-divider"></div>
          <a href="javascript: checkForUpdates(true)" class="dropdown-item notify-item">
            <i class="fe-refresh-cw"></i>
            <span>Check for Updates</span>
          </a>
          {% endif %}
          <div class="dropdown-divider"></div>
          <a href="{% url 'logout' %}" class="dropdown-item notify-item">
            <i class="fe-log-out"></i>
            <span>Logout</span>
          </a>
        </div>
      </li>
      <li class="dropdown top-activity-counter">
        <a class="nav-link dropdown-toggle waves-effect waves-light right-bar-toggle" href="javascript:getScanStatusSidebar('{% url 'api:scan_status' %}', '{% url 'api:stop_scan' %}', '{% url 'api:fetch_subscan_results' %}', project='{{current_project.slug}}', reload=false)">
          <i class="fe-activity noti-icon"></i>
          <span class="badge bg-danger noti-icon-badge"><span id="current_scan_counter">0</span></span>
        </a>
      </li>
    </ul>
    <div class="logo-box">
      <a href="{% url 'dashboardIndex' current_project.slug %}" class="logo logo-dark text-center">
        <span class="logo-sm">
          <h3 class="text-logo vertical-center">BoltR&nbsp;<small>{{ RENGINE_CURRENT_VERSION }}</small></h3>
        </span>
        <span class="logo-lg">
          <h3 class="text-logo vertical-center">BoltR&nbsp;<small>{{ RENGINE_CURRENT_VERSION }}</small></h3>
        </span>
      </a>
      <a href="{% url 'dashboardIndex' current_project.slug %}" class="logo logo-light text-center">
        <span class="logo-sm">
          <h3 class="text-sm-logo vertical-center">BoltR&nbsp;<small>{{ RENGINE_CURRENT_VERSION }}</small></h3>
        </span>
        <span class="logo-lg">
          <h3 class="text-lg-logo vertical-center">BoltR&nbsp;<small>{{ RENGINE_CURRENT_VERSION }}</small></h3>
        </span>
      </a>
    </div>
    <ul class="list-unstyled topnav-menu topnav-menu-left m-0">
      <li>
        <button class="button-menu-mobile waves-effect waves-light">
          <i class="fe-menu"></i>
        </button>
      </li>
      <li>
        <a class="navbar-toggle nav-link" data-bs-toggle="collapse" data-bs-target="#topnav-menu-content">
          <div class="lines">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </a>
      </li>
    </ul>
    <div class="clearfix"></div>
  </div>
  <div class="boltr-second-nav">
    <div class="container-fluid d-flex align-items-center flex-nowrap">
      <ul class="boltr-nav-links mb-0 ps-0">
        <li><a href="{% url 'dashboardIndex' current_project.slug %}"><i class="fe-home me-1"></i> Dashboard</a></li>
        <li><a href="{% url 'list_projects' %}"><i class="fe-folder me-1"></i> Projects</a></li>
        <li><a href="{% url 'list_target' current_project.slug %}"><i class="fe-crosshair me-1"></i> Targets</a></li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fe-activity me-1"></i> Scan History <span class="arrow-down"></span></a>
          <div class="dropdown-menu">
            <a href="{% url 'scan_history' current_project.slug %}" class="dropdown-item">Scan History</a>
            <a href="{% url 'subscan_history' current_project.slug %}" class="dropdown-item">Sub Scan History</a>
            <a href="{% url 'scheduled_scan_view' current_project.slug %}" class="dropdown-item">Scheduled Scan</a>
            <div class="dropdown-divider"></div>
            <a href="{% url 'all_subdomains' current_project.slug %}" class="dropdown-item">All Subdomains</a>
            <a href="{% url 'all_endpoints' current_project.slug %}" class="dropdown-item">All Endpoints</a>
          </div>
        </li>
        <li><a href="{% url 'all_vulns' current_project.slug %}"><i class="fe-alert-triangle me-1"></i> Vulnerabilities</a></li>
        <li><a href="{% url 'list_note' current_project.slug %}"><i class="fe-check-square me-1"></i> To-do</a></li>
        <li><a href="{% url 'list_organization' current_project.slug %}"><i class="fe-briefcase me-1"></i> Organization</a></li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-bs-toggle="dropdown"><i class="fe-cpu me-1"></i> Scan Engine <span class="arrow-down"></span></a>
          <div class="dropdown-menu">
            {% if user|can:'modify_scan_configurations' %}<a href="{% url 'scan_engine_index' %}" class="dropdown-item">Scan Engines</a>{% endif %}
            {% if user|can:'modify_wordlists' %}<a href="{% url 'wordlist_list' %}" class="dropdown-item">Wordlists</a>{% endif %}
            {% if user|can:'modify_interesting_lookup' %}<a href="{% url 'interesting_lookup' %}" class="dropdown-item">Interesting Lookup</a>{% endif %}
          </div>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-bs-toggle="dropdown"><i class="fe-settings me-1"></i> Settings <span class="arrow-down"></span></a>
          <div class="dropdown-menu">
            {% if user|can:'modify_scan_configurations' %}<a href="{% url 'proxy_settings' %}" class="dropdown-item">Proxies</a><a href="{% url 'tool_settings' %}" class="dropdown-item">Tool Settings</a>{% endif %}
            {% if user|can:'modify_system_configurations' %}<a href="{% url 'api_vault' %}" class="dropdown-item">API Vault</a><a href="{% url 'llm_toolkit' %}" class="dropdown-item">LLM Toolkit</a><a href="{% url 'tool_arsenal' %}" class="dropdown-item">Tools Arsenal</a>{% endif %}
            {% if user|can:'modify_scan_report' %}<a href="{% url 'report_settings' %}" class="dropdown-item">Report Settings</a>{% endif %}
            {% if user|can:'modify_system_configurations' %}<a href="{% url 'rengine_settings' %}" class="dropdown-item">BoltR Settings</a>{% endif %}
            {% if user|can:'modify_scan_configurations' %}<a href="{% url 'notification_settings' %}" class="dropdown-item">Notification Settings</a>{% endif %}
          </div>
        </li>
      </ul>
      <span class="badge bg-blue ms-auto" data-bs-toggle="tooltip" title="Current Project">{{ current_project.name }}</span>
    </div>
  </div>
</div>

<div class="modal fade" id="wafDetectorModal" tabindex="-1" role="dialog" aria-labelledby="wafDetectorModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title">WAF Detector</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
              <div class="mb-1">
                  <label for="waf_detector_input_url" class="form-label">HTTP URL/Domain Name</label>
                  <input class="form-control" type="text" id="waf_detector_input_url" required="" placeholder="https://yourdomain.com">
              </div>
              <small class="mb-3 float-end text-muted">(BoltR uses <a href="https://github.com/EnableSecurity/wafw00f" target="_blank">wafw00f</a> to detect WAF.)</small>
              <div class="mt-3 mb-3 text-center">
                  <button class="btn btn-primary float-end" type="submit" id="detect_waf_submit_btn" data-url="{% url 'api:waf_detector' %}">Detect WAF</button>
              </div>
          </div>
      </div>
  </div>
</div>

<div class="modal fade" id="cmsDetectorModal" tabindex="-1" role="dialog" aria-labelledby="cmsDetectorModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title">Detect CMS</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
              <div class="mb-1">
                  <label for="cms_detector_input_url" class="form-label">HTTP URL/Domain Name</label>
                  <input class="form-control" type="text" id="cms_detector_input_url" required="" placeholder="https://yourdomain.com">
              </div>
              <small class="mb-3 float-end text-muted">(BoltR uses <a href="https://github.com/Tuhinshubhra/CMSeeK" target="_blank">CMSeeK</a> to detect CMS.)</small>
              <div class="mt-3 mb-3 text-center">
                  <button class="btn btn-primary float-end" type="submit" id="detect_cms_submit_btn" data-url="{% url 'api:cms_detector' %}">Detect CMS</button>
              </div>
          </div>
      </div>
  </div>
</div>

<div class="modal fade" id="cmsDetectorResultModal" tabindex="-1" role="dialog" aria-labelledby="cmsDetectorModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title">CMS Details</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
      </div>
  </div>
</div>

<div class="modal fade" id="whoisLookupModal" tabindex="-1" role="dialog" aria-labelledby="whoisLookupModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title">WHOIS Lookup</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
              <div class="mb-3">
                  <label for="whois_domain_name" class="form-label">Domain Name/IP Address</label>
                  <input class="form-control" type="text" id="whois_domain_name" required="" placeholder="yourdomain.com">
              </div>
              <div class="mb-3 text-center">
                  <button class="btn btn-primary float-end" type="submit" id="search_whois_toolbox_btn" data-url="{% url 'api:whois' %}" data-slug="{{current_project.slug}}" data-addTargetUrl="{% url 'api:addTarget' %}">Search Whois</button>
              </div>
          </div>
      </div>
  </div>
</div>

<div class="modal fade" id="whoisLookupResultModal" tabindex="-1" role="dialog" aria-labelledby="whoisLookupModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title">WHOIS Details</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
      </div>
  </div>
</div>

<div class="modal fade" id="cveDetailModal" tabindex="-1" role="dialog" aria-labelledby="cveDetailModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title">CVE Details Lookup</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
              <div class="mb-1">
                  <label for="cve_id" class="form-label">CVE ID</label>
                  <input class="form-control" type="text" id="cve_id" required="" placeholder="CVE-XXXX-XXXX">
              </div>
          </div>
          <div class="modal-footer">
              <button class="btn btn-primary float-end" type="submit" id="cve_detail_submit_btn" data-url="{% url 'api:cve_details' %}">Lookup CVE</button>
          </div>
      </div>
  </div>
</div>

<div class="modal fade" id="addTargetModal" tabindex="-1" role="dialog" aria-labelledby="addTargetModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title">Add Target</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
              <p>If you would like to add IP/CIDRs, multiple domains, please <a href="{% url 'add_target' current_project.slug %}">click here.</a></p>
              <div class="mb-3">
                  <label for="target_name_modal" class="form-label">Target Name</label>
                  <input class="form-control" type="text" id="target_name_modal" required="" placeholder="yourdomain.com">
              </div>
              <div class="mb-3">
                  <label for="target_description_modal" class="form-label">Description (Optional)</label>
                  <input class="form-control" type="text" id="target_description_modal" required="" placeholder="Target Description">
              </div>
              <div class="mb-3">
                  <label for="h1_handle_modal" class="form-label">Hackerone Target Team Handle (Optional)</label>
                  <input class="form-control" type="text" id="h1_handle_modal" placeholder="hackerone.com/team_handle, Only enter team_handle after /">
              </div>
              <div class="mb-3">
                  <label for="target_organization_modal" class="form-label">Target Organization (Optional)</label>
                  <input class="form-control" type="text" id="target_organization_modal" placeholder="Target Org">
              </div>
          </div>
          <div class="modal-footer">
              <button class="btn btn-primary float-end" type="submit" id="add_target_modal" data-url="{% url 'api:addTarget' %}" data-slug="{{current_project.slug}}">Add Target</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
      </div>
  </div>
</div>